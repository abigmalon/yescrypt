<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yescryptå¯†ç ç ´è§£å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #555;
            margin: 5px 0;
        }

        .progress-container {
            margin-top: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .result-box {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }

        .result-success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }

        .result-error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }

        .result-info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            color: #0c5460;
        }

        .hash-info {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .hash-info p {
            margin: 5px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-idle {
            background: #6c757d;
        }

        .status-running {
            background: #ffc107;
            animation: pulse 1.5s infinite;
        }

        .status-completed {
            background: #28a745;
        }

        .status-error {
            background: #dc3545;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .log-area {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            display: none;
        }

        .log-entry {
            margin: 5px 0;
        }

        .log-time {
            color: #858585;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” Yescryptå¯†ç ç ´è§£å·¥å…·</h1>
            <p>Kali Linux Shadowæ–‡ä»¶å¯†ç ç ´è§£ç³»ç»Ÿ</p>
        </div>

        <div class="content">
            <!-- é…ç½®åŒºåŸŸ -->
            <div class="section">
                <h2>ğŸ“‹ é…ç½®ä¿¡æ¯</h2>
                <div class="form-group">
                    <label for="dict_file">å­—å…¸æ–‡ä»¶è·¯å¾„ï¼š</label>
                    <input type="text" id="dict_file" value="dict.txt" placeholder="é»˜è®¤: dict.txt">
                </div>
                <div class="form-group">
                    <label for="shadow_file">Shadowæ–‡ä»¶è·¯å¾„ï¼š</label>
                    <input type="text" id="shadow_file" value="shadow.txt" placeholder="é»˜è®¤: shadow.txt">
                </div>
                <button class="btn btn-secondary" onclick="loadShadowInfo()">ğŸ“– è¯»å–Shadowä¿¡æ¯</button>
            </div>

            <!-- è¯»å–ç³»ç»ŸShadowæ–‡ä»¶ -->
            <div class="section">
                <h2>ğŸ’¾ è¯»å–ç³»ç»ŸShadowæ–‡ä»¶</h2>
                <p style="color: #666; margin-bottom: 15px;">ä»ç³»ç»Ÿ /etc/shadow æ–‡ä»¶è¯»å–yescryptå¯†ç å“ˆå¸Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</p>
                <div class="info-box" style="background: #fff3cd; border-left-color: #ffc107;">
                    <h3 style="color: #856404;">âš ï¸ æƒé™æç¤º</h3>
                    <p style="color: #856404;">è¯»å–ç³»ç»Ÿshadowæ–‡ä»¶éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚å¦‚æœç¨‹åºæ²¡æœ‰rootæƒé™ï¼Œç³»ç»Ÿä¼šå°è¯•ä½¿ç”¨sudoå‘½ä»¤ã€‚è¯·ç¡®ä¿ï¼š</p>
                    <ul style="color: #856404; margin-left: 20px; margin-top: 10px;">
                        <li>å½“å‰ç”¨æˆ·å…·æœ‰sudoæƒé™ï¼Œæˆ–</li>
                        <li>ä½¿ç”¨rootç”¨æˆ·è¿è¡Œç¨‹åºï¼ˆsudo python3 app.pyï¼‰</li>
                    </ul>
                </div>
                <div class="form-group">
                    <label for="system_shadow_output">è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼š</label>
                    <input type="text" id="system_shadow_output" value="shadow.txt" placeholder="é»˜è®¤: shadow.txt">
                </div>
                <button class="btn btn-primary" onclick="readSystemShadow()" id="btn_read_system">ğŸ“¥ è¯»å–ç³»ç»ŸShadowæ–‡ä»¶</button>
                <div class="result-box" id="system_shadow_result" style="display: none;"></div>
            </div>

            <!-- ç”Ÿæˆå¯†ç å­—å…¸ -->
            <div class="section">
                <h2>ğŸ”‘ ç”Ÿæˆå¯†ç å­—å…¸</h2>
                <p style="color: #666; margin-bottom: 15px;">è‡ªå®šä¹‰ç”ŸæˆæŒ‡å®šé•¿åº¦çš„å¯†ç å­—å…¸æ–‡ä»¶</p>
                
                <div class="form-group">
                    <label for="dict_length">å¯†ç é•¿åº¦ï¼š</label>
                    <input type="number" id="dict_length" value="4" min="4" max="6" placeholder="4-6ä½">
                </div>
                
                <div class="form-group">
                    <label for="custom_charset">è‡ªå®šä¹‰å­—ç¬¦é›†ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                    <input type="text" id="custom_charset" placeholder="ä¾‹å¦‚: 0123456789 æˆ– abcABC123 æˆ– ç›´æ¥è¾“å…¥ä»»æ„å­—ç¬¦">
                    <p style="color: #666; font-size: 0.9em; margin-top: 5px;">å¦‚æœå¡«å†™æ­¤é¡¹ï¼Œå°†ä½¿ç”¨æ‚¨æŒ‡å®šçš„å­—ç¬¦é›†ï¼Œå¿½ç•¥ä¸‹é¢çš„å¤é€‰æ¡†é€‰é¡¹</p>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="use_digits" checked style="width: auto; margin-right: 10px;">
                        ä½¿ç”¨æ•°å­— (0-9)
                    </label>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="use_letters" checked style="width: auto; margin-right: 10px;">
                        ä½¿ç”¨å­—æ¯ (a-z, A-Z)
                    </label>
                </div>
                <div class="form-group">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="use_special" style="width: auto; margin-right: 10px;">
                        ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ (!@#$%^&*()_+-=[]{}|;:,.<>?)
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="dict_output_file">è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼š</label>
                    <input type="text" id="dict_output_file" value="dict.txt" placeholder="é»˜è®¤: dict.txt">
                </div>
                
                <div class="info-box" style="background: #d1ecf1; border-left-color: #17a2b8;">
                    <p style="color: #0c5460;"><strong>æ³¨æ„ï¼š</strong>å¦‚æœè¾“å‡ºæ–‡ä»¶å·²å­˜åœ¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºå‰¯æœ¬ï¼ˆå¦‚ dict_1.txt, dict_2.txt ç­‰ï¼‰</p>
                    <p style="color: #0c5460; margin-top: 5px;"><strong>æç¤ºï¼š</strong>å¯†ç æ•°é‡ = å­—ç¬¦é›†å¤§å° ^ é•¿åº¦ã€‚ä¾‹å¦‚ï¼š4ä½æ•°å­—+å­—æ¯ = 62^4 = 14,776,960 ä¸ªå¯†ç ï¼ˆå¯èƒ½è¿‡å¤§ï¼‰</p>
                    <p style="color: #0c5460; margin-top: 5px;"><strong>è‡ªå®šä¹‰å­—ç¬¦é›†ç¤ºä¾‹ï¼š</strong></p>
                    <ul style="color: #0c5460; margin-left: 20px; margin-top: 5px;">
                        <li>ä»…æ•°å­—ï¼š<code>0123456789</code></li>
                        <li>ä»…å°å†™å­—æ¯ï¼š<code>abcdefghijklmnopqrstuvwxyz</code></li>
                        <li>æ•°å­—+å­—æ¯ï¼š<code>0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ</code></li>
                        <li>è‡ªå®šä¹‰ç»„åˆï¼š<code>abc123!@#</code></li>
                    </ul>
                </div>
                
                <button class="btn btn-primary" onclick="generateDict()" id="btn_generate_dict">âš™ï¸ ç”Ÿæˆå¯†ç å­—å…¸</button>
                <div class="result-box" id="dict_result" style="display: none;"></div>
            </div>

            <!-- Shadowä¿¡æ¯æ˜¾ç¤º -->
            <div class="section" id="shadow_info_section" style="display: none;">
                <h2>ğŸ‘¤ Shadowæ–‡ä»¶ä¿¡æ¯</h2>
                <div id="shadow_info"></div>
            </div>

            <!-- å½©è™¹è¡¨ç”Ÿæˆ -->
            <div class="section">
                <h2>ğŸŒˆ ç”Ÿæˆå½©è™¹è¡¨</h2>
                <p style="color: #666; margin-bottom: 15px;">å°†å­—å…¸ä¸­çš„å¯†ç åŠ å¯†åç”Ÿæˆå½©è™¹è¡¨æ–‡ä»¶</p>
                <button class="btn btn-primary" onclick="generateRainbow()" id="btn_rainbow">ğŸš€ ç”Ÿæˆå½©è™¹è¡¨</button>
                
                <div class="progress-container" id="rainbow_progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="rainbow_progress_fill">0%</div>
                    </div>
                    <p id="rainbow_status">å‡†å¤‡ä¸­...</p>
                </div>

                <div class="result-box" id="rainbow_result"></div>
            </div>

            <!-- å¯†ç ç ´è§£ -->
            <div class="section">
                <h2>ğŸ”“ å¯†ç ç ´è§£</h2>
                <p style="color: #666; margin-bottom: 15px;">ä½¿ç”¨å­—å…¸æ–‡ä»¶ç ´è§£shadowæ–‡ä»¶ä¸­çš„å¯†ç </p>
                <button class="btn btn-primary" onclick="startCrack()" id="btn_crack">âš¡ å¼€å§‹ç ´è§£</button>
                
                <div class="progress-container" id="crack_progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="crack_progress_fill">0%</div>
                    </div>
                    <p id="crack_status">å‡†å¤‡ä¸­...</p>
                </div>

                <div class="result-box" id="crack_result"></div>
            </div>
        </div>
    </div>

    <script>
        let crackProgressInterval = null;
        let rainbowProgressInterval = null;

        // è¯»å–Shadowä¿¡æ¯
        async function loadShadowInfo() {
            const shadowFile = document.getElementById('shadow_file').value || 'shadow.txt';
            
            try {
                const response = await fetch(`/api/shadow/read?file=${encodeURIComponent(shadowFile)}`);
                const data = await response.json();
                
                if (data.success) {
                    const section = document.getElementById('shadow_info_section');
                    const infoDiv = document.getElementById('shadow_info');
                    
                    let html = `<p style="margin-bottom: 15px; color: #666;"><strong>æ‰¾åˆ° ${data.count} ä¸ªæ¡ç›®ï¼š</strong></p>`;
                    
                    // æ˜¾ç¤ºæ‰€æœ‰æ¡ç›®
                    data.entries.forEach((entry, index) => {
                        html += `
                            <div class="info-box" style="margin-bottom: 15px;">
                                <h3>ç”¨æˆ· ${index + 1}: ${entry.username}</h3>
                                <p><strong>å®Œæ•´å“ˆå¸Œ:</strong> <code style="word-break: break-all;">${entry.hash}</code></p>
                                <div class="hash-info" style="margin-top: 10px;">
                                    <p><strong>ç®—æ³•æ ‡è¯†:</strong> ${entry.hash_info.algorithm}</p>
                                    <p><strong>è½®æ•°å‚æ•°:</strong> ${entry.hash_info.rounds}</p>
                                    <p><strong>Saltå€¼:</strong> ${entry.hash_info.salt}</p>
                                    <p><strong>å“ˆå¸Œå€¼:</strong> ${entry.hash_info.hash}</p>
                                    <p><strong>å®Œæ•´Salt:</strong> <code>${entry.hash_info.full_salt}</code></p>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `<p style="color: #666; font-size: 0.9em; margin-top: 10px;">æ³¨æ„ï¼šç ´è§£åŠŸèƒ½å°†ä½¿ç”¨ç¬¬ä¸€ä¸ªæ¡ç›®è¿›è¡Œç ´è§£</p>`;
                    
                    infoDiv.innerHTML = html;
                    section.style.display = 'block';
                } else {
                    alert('é”™è¯¯: ' + data.message);
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥: ' + error.message);
            }
        }

        // è¯»å–ç³»ç»ŸShadowæ–‡ä»¶
        async function readSystemShadow() {
            const outputFile = document.getElementById('system_shadow_output').value || 'shadow.txt';
            const btn = document.getElementById('btn_read_system');
            const resultDiv = document.getElementById('system_shadow_result');
            
            btn.disabled = true;
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('/api/shadow/read-system', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        output_file: outputFile
                    })
                });
                
                const data = await response.json();
                resultDiv.style.display = 'block';
                btn.disabled = false;
                
                if (data.success) {
                    resultDiv.className = 'result-box result-success';
                    resultDiv.innerHTML = `
                        <h3>âœ… è¯»å–æˆåŠŸ</h3>
                        <p>${data.message}</p>
                        <p><strong>æ‰¾åˆ°æ¡ç›®æ•°:</strong> ${data.count}</p>
                        <p><strong>è¾“å‡ºæ–‡ä»¶:</strong> ${data.output_file}</p>
                        <p style="margin-top: 10px; color: #155724;">æç¤ºï¼šæ–‡ä»¶å·²ä¿å­˜ï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨"è¯»å–Shadowä¿¡æ¯"æŒ‰é’®æŸ¥çœ‹å†…å®¹ã€‚</p>
                    `;
                    // è‡ªåŠ¨æ›´æ–°shadowæ–‡ä»¶è·¯å¾„
                    document.getElementById('shadow_file').value = data.output_file;
                } else {
                    resultDiv.className = 'result-box result-error';
                    resultDiv.innerHTML = `
                        <h3>âŒ è¯»å–å¤±è´¥</h3>
                        <p>${data.message}</p>
                    `;
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result-box result-error';
                resultDiv.innerHTML = `
                    <h3>âŒ è¯·æ±‚å¤±è´¥</h3>
                    <p>${error.message}</p>
                `;
                btn.disabled = false;
            }
        }

        // ç”Ÿæˆå¯†ç å­—å…¸
        async function generateDict() {
            const length = parseInt(document.getElementById('dict_length').value);
            const customCharset = document.getElementById('custom_charset').value.trim();
            const useDigits = document.getElementById('use_digits').checked;
            const useLetters = document.getElementById('use_letters').checked;
            const useSpecial = document.getElementById('use_special').checked;
            const outputFile = document.getElementById('dict_output_file').value || 'dict.txt';
            const btn = document.getElementById('btn_generate_dict');
            const resultDiv = document.getElementById('dict_result');
            
            // éªŒè¯é•¿åº¦
            if (length < 4 || length > 6) {
                alert('å¯†ç é•¿åº¦å¿…é¡»åœ¨4-6ä½ä¹‹é—´');
                return;
            }
            
            // å¦‚æœä½¿ç”¨è‡ªå®šä¹‰å­—ç¬¦é›†ï¼ŒéªŒè¯å­—ç¬¦é›†
            if (customCharset) {
                if (customCharset.length === 0) {
                    alert('è‡ªå®šä¹‰å­—ç¬¦é›†ä¸èƒ½ä¸ºç©º');
                    return;
                }
                // è®¡ç®—å¯†ç æ•°é‡
                const totalPossible = Math.pow(customCharset.length, length);
                if (totalPossible > 1000000) {
                    const confirm = window.confirm(
                        `è­¦å‘Šï¼šå°†ç”Ÿæˆçº¦ ${totalPossible.toLocaleString()} ä¸ªå¯†ç ï¼ˆå­—ç¬¦é›†å¤§å°: ${customCharset.length}ï¼Œé•¿åº¦: ${length}ï¼‰ï¼Œè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´å’Œå¤§é‡ç£ç›˜ç©ºé—´ã€‚\n\næ˜¯å¦ç»§ç»­ï¼Ÿ`
                    );
                    if (!confirm) {
                        return;
                    }
                }
            } else {
                // ä½¿ç”¨å¤é€‰æ¡†é€‰é¡¹ï¼ŒéªŒè¯è‡³å°‘é€‰æ‹©ä¸€ç§å­—ç¬¦ç±»å‹
                if (!useDigits && !useLetters && !useSpecial) {
                    alert('è‡³å°‘éœ€è¦é€‰æ‹©ä¸€ç§å­—ç¬¦ç±»å‹ï¼ˆæ•°å­—ã€å­—æ¯æˆ–ç‰¹æ®Šå­—ç¬¦ï¼‰ï¼Œæˆ–å¡«å†™è‡ªå®šä¹‰å­—ç¬¦é›†');
                    return;
                }
                
                // è®¡ç®—å¯èƒ½çš„å¯†ç æ•°é‡ï¼ˆç”¨äºè­¦å‘Šï¼‰
                let charsetSize = 0;
                if (useDigits) charsetSize += 10;
                if (useLetters) charsetSize += 52;
                if (useSpecial) charsetSize += 20;
                const totalPossible = Math.pow(charsetSize, length);
                
                if (totalPossible > 1000000) {
                    const confirm = window.confirm(
                        `è­¦å‘Šï¼šå°†ç”Ÿæˆçº¦ ${totalPossible.toLocaleString()} ä¸ªå¯†ç ï¼Œè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´å’Œå¤§é‡ç£ç›˜ç©ºé—´ã€‚\n\næ˜¯å¦ç»§ç»­ï¼Ÿ`
                    );
                    if (!confirm) {
                        return;
                    }
                }
            }
            
            btn.disabled = true;
            resultDiv.style.display = 'none';
            
            try {
                const requestBody = {
                    length: length,
                    output_file: outputFile
                };
                
                // å¦‚æœæä¾›äº†è‡ªå®šä¹‰å­—ç¬¦é›†ï¼Œä¼˜å…ˆä½¿ç”¨
                if (customCharset) {
                    requestBody.custom_charset = customCharset;
                } else {
                    requestBody.use_digits = useDigits;
                    requestBody.use_letters = useLetters;
                    requestBody.use_special = useSpecial;
                }
                
                const response = await fetch('/api/dict/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                resultDiv.style.display = 'block';
                btn.disabled = false;
                
                if (data.success) {
                    resultDiv.className = 'result-box result-success';
                    resultDiv.innerHTML = `
                        <h3>âœ… ç”ŸæˆæˆåŠŸ</h3>
                        <p>${data.message}</p>
                        <p><strong>ç”Ÿæˆå¯†ç æ•°:</strong> ${data.count.toLocaleString()}</p>
                        <p><strong>è¾“å‡ºæ–‡ä»¶:</strong> ${data.output_file}</p>
                        <p style="margin-top: 10px; color: #155724;">æç¤ºï¼šæ–‡ä»¶å·²ä¿å­˜ï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨è¯¥å­—å…¸æ–‡ä»¶è¿›è¡Œç ´è§£ã€‚</p>
                    `;
                    // è‡ªåŠ¨æ›´æ–°å­—å…¸æ–‡ä»¶è·¯å¾„
                    document.getElementById('dict_file').value = data.output_file;
                } else {
                    resultDiv.className = 'result-box result-error';
                    resultDiv.innerHTML = `
                        <h3>âŒ ç”Ÿæˆå¤±è´¥</h3>
                        <p>${data.message}</p>
                    `;
                }
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result-box result-error';
                resultDiv.innerHTML = `
                    <h3>âŒ è¯·æ±‚å¤±è´¥</h3>
                    <p>${error.message}</p>
                `;
                btn.disabled = false;
            }
        }

        // ç”Ÿæˆå½©è™¹è¡¨
        async function generateRainbow() {
            const dictFile = document.getElementById('dict_file').value || 'dict.txt';
            const shadowFile = document.getElementById('shadow_file').value || 'shadow.txt';
            const btn = document.getElementById('btn_rainbow');
            const progressDiv = document.getElementById('rainbow_progress');
            const resultDiv = document.getElementById('rainbow_result');
            
            btn.disabled = true;
            progressDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('/api/rainbow/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        dict_file: dictFile,
                        shadow_file: shadowFile,
                        rainbow_file: 'rainbow.txt'
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    // å¼€å§‹è½®è¯¢è¿›åº¦
                    rainbowProgressInterval = setInterval(checkRainbowProgress, 500);
                } else {
                    alert('é”™è¯¯: ' + data.message);
                    btn.disabled = false;
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥: ' + error.message);
                btn.disabled = false;
            }
        }

        // æ£€æŸ¥å½©è™¹è¡¨ç”Ÿæˆè¿›åº¦
        async function checkRainbowProgress() {
            try {
                const response = await fetch('/api/rainbow/progress');
                const progress = await response.json();
                
                const progressFill = document.getElementById('rainbow_progress_fill');
                const statusText = document.getElementById('rainbow_status');
                const resultDiv = document.getElementById('rainbow_result');
                const btn = document.getElementById('btn_rainbow');
                
                if (progress.total > 0) {
                    const percent = Math.round((progress.current / progress.total) * 100);
                    progressFill.style.width = percent + '%';
                    progressFill.textContent = percent + '%';
                    statusText.textContent = `å¤„ç†ä¸­: ${progress.current} / ${progress.total}`;
                }
                
                if (progress.status === 'completed' || progress.status === 'error') {
                    clearInterval(rainbowProgressInterval);
                    btn.disabled = false;
                    
                    if (progress.result) {
                        resultDiv.style.display = 'block';
                        if (progress.result.success) {
                            resultDiv.className = 'result-box result-success';
                            resultDiv.innerHTML = `
                                <h3>âœ… ç”ŸæˆæˆåŠŸ</h3>
                                <p>${progress.result.message}</p>
                            `;
                        } else {
                            resultDiv.className = 'result-box result-error';
                            resultDiv.innerHTML = `
                                <h3>âŒ ç”Ÿæˆå¤±è´¥</h3>
                                <p>${progress.result.message}</p>
                            `;
                        }
                    }
                }
            } catch (error) {
                console.error('è·å–è¿›åº¦å¤±è´¥:', error);
            }
        }

        // å¼€å§‹ç ´è§£
        async function startCrack() {
            const dictFile = document.getElementById('dict_file').value || 'dict.txt';
            const shadowFile = document.getElementById('shadow_file').value || 'shadow.txt';
            const btn = document.getElementById('btn_crack');
            const progressDiv = document.getElementById('crack_progress');
            const resultDiv = document.getElementById('crack_result');
            
            btn.disabled = true;
            progressDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            
            try {
                const response = await fetch('/api/crack/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        dict_file: dictFile,
                        shadow_file: shadowFile
                    })
                });
                
                const data = await response.json();
                if (data.success) {
                    // å¼€å§‹è½®è¯¢è¿›åº¦
                    crackProgressInterval = setInterval(checkCrackProgress, 500);
                } else {
                    alert('é”™è¯¯: ' + data.message);
                    btn.disabled = false;
                }
            } catch (error) {
                alert('è¯·æ±‚å¤±è´¥: ' + error.message);
                btn.disabled = false;
            }
        }

        // æ£€æŸ¥ç ´è§£è¿›åº¦
        async function checkCrackProgress() {
            try {
                const response = await fetch('/api/crack/progress');
                const progress = await response.json();
                
                const progressFill = document.getElementById('crack_progress_fill');
                const statusText = document.getElementById('crack_status');
                const resultDiv = document.getElementById('crack_result');
                const btn = document.getElementById('btn_crack');
                
                if (progress.total > 0) {
                    const percent = Math.round((progress.current / progress.total) * 100);
                    progressFill.style.width = percent + '%';
                    progressFill.textContent = percent + '%';
                    statusText.textContent = `å°è¯•ä¸­: ${progress.current} / ${progress.total} (å½“å‰: ${progress.current_password || 'N/A'})`;
                }
                
                if (progress.status === 'completed' || progress.status === 'error') {
                    clearInterval(crackProgressInterval);
                    btn.disabled = false;
                    
                    if (progress.result) {
                        resultDiv.style.display = 'block';
                        if (progress.result.success) {
                            resultDiv.className = 'result-box result-success';
                            resultDiv.innerHTML = `
                                <h3>ğŸ‰ ç ´è§£æˆåŠŸï¼</h3>
                                <p><strong>ç”¨æˆ·å:</strong> ${progress.result.username}</p>
                                <p><strong>å¯†ç æ˜æ–‡:</strong> <code style="font-size: 1.2em; color: #28a745; font-weight: bold;">${progress.result.password}</code></p>
                                <p><strong>å°è¯•æ¬¡æ•°:</strong> ${progress.result.attempts} / ${progress.result.total}</p>
                                <p>${progress.result.message}</p>
                            `;
                        } else {
                            resultDiv.className = 'result-box result-error';
                            resultDiv.innerHTML = `
                                <h3>âŒ ç ´è§£å¤±è´¥</h3>
                                <p>${progress.result.message}</p>
                                <p><strong>å·²å°è¯•:</strong> ${progress.result.attempts} / ${progress.result.total} ä¸ªå¯†ç </p>
                            `;
                        }
                    }
                }
            } catch (error) {
                console.error('è·å–è¿›åº¦å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¯»å–shadowä¿¡æ¯
        window.addEventListener('load', function() {
            loadShadowInfo();
        });
    </script>
</body>
</html>

